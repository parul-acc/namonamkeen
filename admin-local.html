<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Namo Namkeen (LOCAL DEV)</title>
    <link rel="icon" href="logo.jpg" type="image/jpeg">

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link rel="stylesheet" href="admin.css">
    <link rel="manifest" href="admin-manifest.json">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="loading">

    <div id="login-overlay">
        <img src="logo.jpg" class="login-logo" alt="Logo">
        <h2>Namo Admin</h2>
        <p style="color:#666; font-size:0.9rem; margin-bottom:20px; text-align:center;"><strong>LOCAL DEV MODE</strong><br>(No Gmail Required)</p>
        
        <div style="background:#f0f9ff; padding:15px; border-radius:8px; margin-bottom:20px; border:1px solid #0288d1;">
            <p style="margin:0 0 10px; font-size:0.85rem; font-weight:600;">Quick Dev Login:</p>
            <input type="text" id="dev-password" class="form-control" placeholder="Enter any password" 
                style="margin-bottom:10px; padding:10px;" onkeydown="if(event.key==='Enter') devLogin()">
            <button class="btn btn-primary login-btn" onclick="devLogin()" style="width:100%;">
                <i class="fas fa-unlock"></i> Dev Login
            </button>
        </div>

        <hr style="border:0; border-top:1px dashed #ddd; margin:20px 0;">

        <button class="btn btn-primary login-btn" onclick="adminLogin()" style="opacity:0.5; cursor:not-allowed;" disabled>
            <i class="fab fa-google"></i> Sign in with Google (Prod)
        </button>
        <small style="display:block; text-align:center; color:#999; margin-top:10px;">
            â“˜ Gmail login disabled in local dev mode
        </small>
    </div>

    <div id="sidebar-overlay" onclick="toggleSidebar()"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:99;">
    </div>

    <nav class="sidebar" id="sidebar">
        <div class="brand">
            <div class="brand-left">
                <img src="logo.jpg" alt="Logo">
                <h3>Admin</h3>
            </div>
            <button class="close-sidebar" onclick="toggleSidebar()">&times;</button>
        </div>
        <ul class="nav-links">
            <li><a onclick="switchView('dashboard')" id="nav-dashboard" class="active"><i class="fas fa-chart-pie"></i>
                    Dashboard</a></li>
            <li><a onclick="switchView('pos')" id="nav-pos"><i class="fas fa-cash-register"></i> New Order (POS)</a>
            </li>
            <li><a onclick="switchView('inventory')" id="nav-inventory"><i class="fas fa-boxes"></i> Inventory</a></li>
            <li><a onclick="switchView('orders')" id="nav-orders"><i class="fas fa-shopping-bag"></i> Orders</a></li>
            <li><a onclick="switchView('customers')" id="nav-customers"><i class="fas fa-users"></i> Customers</a></li>
            <li><a onclick="switchView('coupons')" id="nav-coupons"><i class="fas fa-ticket-alt"></i> Coupons</a></li>
            <li><a onclick="switchView('reviews')" id="nav-reviews"><i class="fas fa-star"></i> Reviews</a></li>
            <li><a onclick="switchView('abandoned')" id="nav-abandoned"><i class="fas fa-shopping-cart"></i>
                    Abandoned</a></li>
            <li><a onclick="switchView('blogs')" id="nav-blogs"><i class="fas fa-pen-nib"></i> Blog CMS</a></li>
            <li><a onclick="switchView('reports')" id="nav-reports"><i class="fas fa-chart-line"></i> Reports</a></li>
            <li><a onclick="switchView('finance')" id="nav-finance"><i class="fas fa-rupee-sign"></i> Finance</a></li>
            <li><a onclick="switchView('settings')" id="nav-settings"><i class="fas fa-cog"></i> Settings</a></li>
        </ul>
        <div class="sidebar-footer">
            <button id="admin-install-btn" class="logout-btn"
                style="display:none; margin-bottom:10px; background:#2ecc71; color:white; border:none;">
                <i class="fas fa-download"></i> Install App
            </button>
            <button onclick="logout()" class="btn logout-btn">Logout</button>
        </div>
    </nav>

    <div class="main-content">
        <header class="top-bar">
            <div class="top-bar-left">
                <svg class="toggle-menu" onclick="toggleSidebar()" viewBox="0 0 24 24" width="24" height="24"
                    stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"
                    style="cursor:pointer; color:var(--primary);">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
                <h3 id="page-title">Dashboard</h3>
            </div>
            <button id="sound-btn" class="btn btn-outline btn-sm" onclick="enableSound()" style="margin-right: 15px;">
                <i class="fas fa-volume-mute"></i> Enable Sound
            </button>
            <div id="admin-user-info">Admin</div>
        </header>

        <div id="view-dashboard" class="view-section active">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin:0; color:var(--dark);">Overview</h2>
                <select id="dashboard-filter" class="form-control" style="width: auto; font-weight:600;"
                    onchange="updateDashboardFilter(this.value)">
                    <option value="All">All Time</option>
                    <option value="Today">Today</option>
                    <option value="Week">This Week</option>
                    <option value="Month">This Month</option>
                    <option value="Year">This Year</option>
                </select>
            </div>

            <div class="stats-grid">
                <div class="stat-card border-green">
                    <h3>Revenue</h3>
                    <h1 id="today-rev">â‚¹0</h1>
                </div>
                <div class="stat-card border-blue">
                    <h3>Orders</h3>
                    <h1 id="total-orders">0</h1>
                </div>
                <div class="stat-card border-red">
                    <h3>Pending</h3>
                    <h1 id="pending-count">0</h1>
                </div>
                <div class="stat-card border-purple">
                    <h3>Avg Order</h3>
                    <h1 id="avg-order">â‚¹0</h1>
                </div>
            </div>

            <div id="low-stock-alert"
                style="display:none; background:#fff3cd; border:1px solid #ffeeba; color:#856404; padding:15px; border-radius:10px; margin-bottom:20px; align-items:center; gap:15px;">
                <div style="font-size:1.5rem;"><i class="fas fa-exclamation-triangle"></i></div>
                <div style="flex:1;">
                    <h4 style="margin:0;">Low Stock Alert</h4>
                    <p style="margin:5px 0 0; font-size:0.9rem;">The following items are running low or out of stock:
                    </p>
                    <div id="low-stock-list" style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;"></div>
                </div>
            </div>

            <div class="charts-grid">
                <div class="chart-box"><canvas id="salesChart"></canvas></div>
                <div class="chart-box"><canvas id="productChart"></canvas></div>
                <div class="chart-box"><canvas id="paymentChart"></canvas></div>
            </div>

            <div class="card" style="margin-top: 20px;">
                <div class="card-header">
                    <h3>Customer Insights</h3>
                </div>
                <div
                    style="padding: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div>
                        <h4>Customer Segments</h4>
                        <canvas id="segmentationChart"></canvas>
                    </div>
                    <div>
                        <h4>Top Customers (CLV)</h4>
                        <div id="top-customers-list"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- POS, Inventory, Orders, Customers, Coupons, Reviews, Abandoned, Blogs, Reports, Finance, Settings sections -->
        <!-- (Copy all view sections from admin.html - truncated for brevity) -->
        <div id="view-pos" class="view-section"><div class="card"><p>POS Module - Coming Soon</p></div></div>
        <div id="view-inventory" class="view-section"><div class="card"><p>Inventory Module - Coming Soon</p></div></div>
        <div id="view-orders" class="view-section"><div class="card"><p>Orders Module - Coming Soon</p></div></div>
        <div id="view-customers" class="view-section"><div class="card"><p>Customers Module - Coming Soon</p></div></div>
        <div id="view-coupons" class="view-section"><div class="card"><p>Coupons Module - Coming Soon</p></div></div>
        <div id="view-reviews" class="view-section"><div class="card"><p>Reviews Module - Coming Soon</p></div></div>
        <div id="view-abandoned" class="view-section"><div class="card"><p>Abandoned Module - Coming Soon</p></div></div>
        <div id="view-blogs" class="view-section"><div class="card"><p>Blogs Module - Coming Soon</p></div></div>
        <div id="view-reports" class="view-section"><div class="card"><p>Reports Module - Coming Soon</p></div></div>
        <div id="view-finance" class="view-section"><div class="card"><p>Finance Module - Coming Soon</p></div></div>
        <div id="view-settings" class="view-section"><div class="card"><p>Settings Module - Coming Soon</p></div></div>

        <div id="product-modal" class="modal" style="display:none;"></div>
        <div id="logs-modal" class="modal" style="display:none;"></div>
        <div id="order-modal" class="modal" style="display:none;"></div>
        <div id="customer-modal" class="modal" style="display:none;"></div>
        <div id="blog-editor-modal" class="modal" style="display:none;"></div>
        <div id="expense-modal" class="modal" style="display:none;"></div>
        <div id="toast-container"></div>

        <footer class="admin-footer">
            Â© 2025 Namo Namkeen Admin Panel (LOCAL DEV MODE). Designed by Parul Gangwal.
        </footer>
    </div>

    <!-- LOCAL DEV AUTH - NO FIREBASE NEEDED -->
    <script>
        let currentUser = null;
        const LOCAL_DEV_MODE = true;

        // ===== DEV LOGIN FUNCTION =====
        function devLogin() {
            const password = document.getElementById('dev-password').value;
            if (password.trim()) {
                // Simple dev auth - any non-empty password works locally
                currentUser = {
                    uid: 'dev-admin-' + Date.now(),
                    displayName: 'Dev Admin',
                    email: 'dev@localhost'
                };
                localStorage.setItem('adminSession', JSON.stringify(currentUser));
                localStorage.setItem('adminLoginTime', new Date().toISOString());
                localStorage.setItem('LOCAL_DEV_MODE', 'true');
                showLoginSuccess();
            } else {
                alert('Please enter a password');
            }
        }

        function adminLogin() {
            alert('Gmail login is disabled in local dev mode.\n\nUse the Dev Login button above to test locally.');
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                currentUser = null;
                localStorage.removeItem('adminSession');
                localStorage.removeItem('LOCAL_DEV_MODE');
                location.reload();
            }
        }

        function showLoginSuccess() {
            document.getElementById('login-overlay').style.display = 'none';
            document.body.classList.remove('loading');
            document.getElementById('admin-user-info').textContent = currentUser.displayName || 'Admin';
            console.log('âœ“ Local dev session started');
        }

        // Check for existing session on page load
        window.addEventListener('DOMContentLoaded', () => {
            const session = localStorage.getItem('adminSession');
            if (session && LOCAL_DEV_MODE) {
                try {
                    currentUser = JSON.parse(session);
                    showLoginSuccess();
                } catch (e) {
                    console.warn('Invalid session, showing login');
                }
            }
        });

        // ===== HELPER FUNCTIONS FOR LOCAL TESTING =====
        function switchView(view) {
            const sections = document.querySelectorAll('.view-section');
            sections.forEach(s => s.classList.remove('active'));
            const target = document.getElementById('view-' + view);
            if (target) {
                target.classList.add('active');
                document.getElementById('page-title').textContent = 
                    view.charAt(0).toUpperCase() + view.slice(1).replace(/([A-Z])/g, ' $1');
                updateNavHighlight(view);
            }
        }

        function updateNavHighlight(view) {
            const navItems = document.querySelectorAll('.nav-links li');
            navItems.forEach(li => li.classList.remove('active'));
            const el = document.getElementById('nav-' + view);
            if (el && el.parentElement) {
                el.parentElement.classList.add('active');
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            const isOpen = getComputedStyle(sidebar).left !== '-100%' && sidebar.style.left !== '-100%';
            sidebar.style.left = isOpen ? '-100%' : '0';
            overlay.style.display = isOpen ? 'none' : 'block';
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.style.display = 'none';
        }

        // Stub functions for compatibility - will be extended by admin.js
        function enableSound() { console.log('Sound enabled'); }
        function openProductModal() { alert('Product modal - Not implemented in local mode'); }
        function saveCoupon() { alert('Save coupon - Not implemented in local mode'); }
        function openExpenseModal() { alert('Expense modal - Not implemented in local mode'); }
        function saveStoreConfig() { alert('Store config saved - Not implemented in local mode'); }
        function saveLayoutConfig() { alert('Layout saved - Not implemented in local mode'); }
        function saveSettings() { alert('Settings saved - Not implemented in local mode'); }
        function generateReport() { alert('Report generation - Not implemented in local mode'); }
        function openBlogEditor() { alert('Blog editor - Not implemented in local mode'); }
        function handleFileUpload() {}
        function importFromSheet() { alert('Google Sheet import - Disabled in local mode'); }
        function filterInventory() {}
        function debouncedPosSearch() {}
        function submitPosOrder() { alert('POS order - Not implemented in local mode'); }
        function filterOrders() {}
        function toggleAllOrders() {}
        function bulkUpdateStatus() { alert('Bulk update - Not implemented in local mode'); }
        function bulkPrintSlips() { alert('Print slips - Not implemented in local mode'); }
        function exportOrdersToCSV() { alert('Export - Not implemented in local mode'); }
        function exportAllOrders() { alert('Export all - Not implemented in local mode'); }
        function calculateSegments() { alert('Calculate segments - Not implemented in local mode'); }
        function filterCustomers() {}
        function exportCustomersToCSV() { alert('Export customers - Not implemented in local mode'); }
        function loadStockAlerts() {}
        function loadAbandonedCarts() {}
        function addBannerInput() { alert('Add banner - Not implemented in local mode'); }
        function changePage() {}
        function updateDashboardFilter() {}

        // Setup message
        console.log('ðŸ”§ Admin Local Dev Mode Initialized');
        console.log('âœ“ Firebase not required for local testing');
        console.log('ðŸ’¡ Use dev login with any password to access the dashboard');
    </script>

    <!-- Optional: Load admin.js if available (production features) -->
    <script src="admin.js" onerror="console.log('â„¹ admin.js not loaded - local mode only')"></script>
</body>

</html>
