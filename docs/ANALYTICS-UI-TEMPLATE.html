<!-- ========================================= -->
<!-- ENHANCED ANALYTICS DASHBOARD HTML -->
<!-- Add this to admin.html where appropriate -->
<!-- ========================================= -->

<!-- 1. ADD CLV CARD TO EXISTING STATS-GRID (after existing stat cards) -->
<div class="stat-card border-purple">
    <h3>Avg CLV</h3>
    <h1 id="avg-clv">â‚¹0</h1>
    <p style="font-size:0.85rem; color:#666; margin:5px 0 0;">Customer Lifetime Value</p>
</div>

<!-- ========================================= -->

<!-- 2. ADD CUSTOMER ANALYTICS SECTION (new tab or after dashboard charts) -->
<div id="analytics-customer-section" style="margin-top:40px;">
    <h2 style="color:var(--dark); margin-bottom:20px;">
        <i class="fas fa-users" style="color:#9b59b6;"></i> Customer Analytics
    </h2>

    <!-- Customer Insights Grid -->
    <div
        style="display:grid; grid-template-columns:repeat(auto-fit, minmax(400px, 1fr)); gap:20px; margin-bottom:30px;">

        <!-- Customer Segmentation Chart -->
        <div class="card">
            <div class="card-header">
                <h3>Customer Segmentation</h3>
            </div>
            <div style="padding:20px;">
                <canvas id="segmentationChart" style="max-height:300px;"></canvas>
            </div>
        </div>

        <!-- Top Customers by CLV -->
        <div class="card">
            <div class="card-header">
                <h3>Top 10 Customers by CLV</h3>
            </div>
            <div id="top-customers-list" style="padding:15px; max-height:350px; overflow-y:auto;">
                <p style="color:#666; text-align:center;">Loading...</p>
            </div>
        </div>
    </div>
</div>

<!-- ========================================= -->

<!-- 3. ADD PRODUCT PERFORMANCE SECTION -->
<div id="analytics-product-section" style="margin-top:40px;">
    <h2 style="color:var(--dark); margin-bottom:20px;">
        <i class="fas fa-chart-line" style="color:#3498db;"></i> Product Performance
    </h2>

    <!-- Revenue Chart -->
    <div class="card" style="margin-bottom:20px;">
        <div class="card-header">
            <h3>Top Revenue Generators (Last 30 Days)</h3>
        </div>
        <div style="padding:20px;">
            <canvas id="revenueByProductChart" style="max-height:300px;"></canvas>
        </div>
    </div>

    <!-- Performance Table -->
    <div class="card">
        <div class="card-header">
            <h3>Product Performance Metrics</h3>
            <button class="btn btn-outline btn-sm" onclick="loadProductPerformance()">
                <i class="fas fa-sync"></i> Refresh
            </button>
        </div>
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Revenue (30d)</th>
                        <th>Units Sold</th>
                        <th>Avg Price</th>
                        <th>Profit Margin</th>
                        <th>Growth Rate</th>
                    </tr>
                </thead>
                <tbody id="product-performance-body">
                    <tr>
                        <td colspan="6" style="text-align:center; padding:20px; color:#666;">
                            Loading product analytics...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- ========================================= -->

<!-- 4. INITIALIZE CHARTS (Add to JavaScript section or inline script) -->
<script>
    // Initialize analytics dashboard when admin is authenticated
    auth.onAuthStateChanged(user => {
        if (user && ADMIN_EMAILS.includes(user.email)) {
            // Small delay to ensure DOM is ready
            setTimeout(() => {
                // Load analytics
                if (typeof loadEnhancedDashboard === 'function') {
                    loadEnhancedDashboard();
                }

                // Render charts if elements exist
                if (document.getElementById('segmentationChart')) {
                    renderCustomerSegmentationChart();
                }
                if (document.getElementById('top-customers-list')) {
                    loadTopCustomers();
                }
                if (document.getElementById('revenueByProductChart')) {
                    renderRevenueByProductChart();
                }
                if (document.getElementById('product-performance-body')) {
                    loadProductPerformance();
                }
            }, 2000);
        }
    });
</script>

<!-- ========================================= -->
<!-- STYLING (Add to admin.css if needed) -->
<!--
.border-purple {
    border-left: 4px solid #9b59b6;
}

.chart-card {
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
-->